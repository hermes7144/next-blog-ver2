# 웹을 안전하게 지켜주는 HTTPS

## 7.1 HTTP의 약점

- 평문(암호화하지 않은) 통신이기 때문에 도청 가능
- 통신 상대를 확인하지 않기 때문에 위장 가능
- 완전성을 증명할 수 없기 때문에 변조 가능

이 약점은 HTTP만이 아닌, 다른 암호화하지 않은 프로토콜에도 공통되는 문제.

### 7.1.1 평문이기 때문에 도청 가능

HTTP는 평문으로 HTTP 메시지를 보내게 됩니다.

**TCP/IP는 도청 가능한 네트워크**
TCP/IP 구조의 통신 내용은 전부 통신 경로의 도중에 엿볼 수 있다.
통신 내용을 엿볼 수 있다는 것은, 암호화된 통신에서도 암호화되지 않은 통신도 같다.
암호화 통신은 메시지 속의 의미는 간파할 수 없을 수도 있겠지만 암호화된 메시지 자체는 엿볼 수 있다.

네트워크 상을 흐르고 있는 패킷을 수집하는 것만으로 도청을 할 수 있다.

**암호화로 도청을 피하다**

1. 통신 암호화
   HTTP에는 암호화 구조는 없지만 SSL(Secure Socket Layer)나 TLS(Transport Layer Security)이라는 다른 프로토콜을 조합함으로써 HTTP의 통신 내용을 암호화할 수 있습니다.
   SSL 등을 이용한 안전한 통신로를 확립하고 나서 그 통신로를 사용해 HTTP 통신을 합니다. SSL을 조합한 HTTP를 HTTPS(HTTP Secure)나 HTTP over SSL이라 불립니다.
2. 콘텐츠 암호화
   통신하고 있는 콘텐츠 내용 자체를 암호화. HTTP에 암호화를 하는 기능은 없기 때문에 HTTP를 사용해서 운반하는 내용을 암호화. 즉, HTTP 메시지에 포함되는 콘텐츠만 암호화.
   주로 웹 서비스 등에서 이용.

### 7.1.2 통신 상대를 확인하지 않기 때문에 위장 가능

**누구나 리퀘스트할 수 있다**
HTTP에 의한 통신에는 상대가 누구인지 처리하는 처리는 없기 때문에 누구든지 리퀘스트를 보낼 수 있습니다. 또한, 리퀘스트가 오면 상대가 누구든지 무언가의 리퀘스트를 반환합니다.
(단, IP 주소나 포트 등에서 그 웹 서버에 액세스 제한이 없는 경우)

- 리퀘스트를 보낸 곳의 웹 서버가 원래 의도한 리스폰스를 보내야 하는 웹서버인지 아닌지를 확인할 수 없다. 위장한 웹 서버일 우려가 있다.
- 리스폰스를 반환한 곳의 클라이언트가 원래 의도한 리퀘스트를 보낸 클라이언트인지 아닌지를 확인할 수 없다. 위장한 클라이언트일 우려가 있다.
- 통신하고 있는 상대가 접근이 허가된 상대인지 아닌지 확인할 수 없다. 중요한 정보를 가진 웹 서버에는 특정 상대만 통신을 허가하고 싶을 때가 있다.
- 어디의 누가 리퀘스트를 했는지를 확인할 수 없다.
- 의미없는 리퀘스트라도 수신하게 된다. 대량의 리퀘스트에 의한 Dos 공격을 방지할 수 없다.

**상대를 확인하는 증명서**
HTTP에서는 통신 상대를 확인할 수 없지만 SSL로 상대를 확인할 수 있습니다. SSL은 암호화뿐만 아니라 상대를 확인하는 수단으로 증명서를 제공하고 있습니다.
증명서는 신뢰할 수 있는 제3자 기관에 의해 발행되는 것이기 때문에 서버나 클라이언트가 실재하는 사실을 증명합니다. 또 그 증명서를 위조하는 것은 매우 어렵습니다.
통신 상대의 서버나 클라이언트가 가진 증명서를 확인함으로써 통신 상대가 내가 통신하고자 하는 상대인지 아닌지를 확인할 수 있습니다.
이 증명서를 이용함으로써, 통신 상대가 내가 통신하고자 하는 서버임을 나타내고 이용자는 개인 정보 누설 등의 위험성이 줄어들게 됩니다.
또한, 클라이언트가 증명서를 가짐으로써 본인 확인을 하고, 웹 사이트 인증에서 이용할 수도 있습니다.

### 7.1.3 완전성을 증명할 수 없기 변조 가능

완전성이란 정보의 정확성을 말합니다. 그것을 증명할 수 없다는 것은 정보가 정확한지 아니지를 확인할 수 없음을 의미합니다.

**수신한 내용이 다를지도 모른다**
HTTP가 완전성을 증명할 수 없다는 뜻은 만약 리퀘스트나 리스폰스가 발신된 후에 상대가 수신할 때까지의 사이에 변조되었다고 하더라도 이 사실을 알 수 없게 된다는 뜻입니다.
즉, 발신된 리퀘스트나 리스폰스와 수스한 리퀘스트나 리스폰스가 같은지 아닌지를 확인할 수 없다는 의미입니다.

예를 들어, 어떤 웹 사이트에서 콘텐츠를 다운로드 했다고 치면 클라이언트에 다운로드한 파일과 서버 상에 있는 파일이 정말로 같은 것인지 아닌지 모른다는 것입니다. 콘텐츠가 도중에 다른 내용으로 변경되었을지도 모릅니다. 만약 콘텐츠가 다른 것으로 변경되었다 하더라도 수신한 측에서 알아챌 수 없습니다.
이와 같이 공격자가 도중에 리퀘스트나 리스폰스를 빼앗아 변조하는 공격을 중간자 공격(Man-in-the-Middle 공격)이라고 부릅니다.

**변조를 방지하려면?**
자주 사용되는 방법 MD5 SHA-1.
이 방법으로 확실히 확인할 수 있는 것은 아니다. 확실히 방지하기에는 HTTPS를 사용할 필요가 있다.

## 7.2 HTTP + 암호화 + 인증 + 완전성 보호 = HTTPS

### 7.2.1 HTTP에 암호화와 인증과 완전성 보호를 더한 HTTPS

HTTPS를 사용하는 통신은 웹페이지의 로그인이나 쇼핑의 결제 화면 등에서 사용되고 있습니다. HTTPS를 사용한 통신은 URI에 http://가 아닌 https://를 상요합니다. 또한 브라우저에서 HTTP가 유효한 웹 사이트에 엑세스하면 자물쇠 마크가 표시되는 등 HTTP와는 다르게 표시되는 경우가 있습니다.

### 7.2.2 HTTPS는 SSL의 껍질을 덮어쓴 HTTP

HTTP 통신을 하는 소켓 부분을 SSL(Secure Socket Layer)이나 TLS(Transport Layer Security)라는 프로토콜로 대체하고 있을 뿐입니다.
보통 HTTP는 직접 TCP와 통신하지만 SSL을 사용한 경우에는 HTTP는 SSL과 통신하고 SSL이 TCP와 통신하게 됩니다. 즉, SSL이라는 껍질을 덮어 쓴 HTTP와 HTTPS인 것입니다.

### 7.2.3 상호간에 키를 교환하는 공개키 암호화 방식

SSL에서는 공개키 암호화 방식이라 불리는 암호화 방식을 채용하고 있습니다.

**공통키 암호의 딜레마**
암호화와 복호화에 하나의 키를 같이 사용하는 방식을 공통 키 암호라고 부릅니다. 공통키 암호화 방식은 상대방에게 키를 넘겨주지 않으면 안된다.
네트워크를 사용해서 키를 넘겨줄 때 통신이 도청되어 공격자에게 키를 빼앗기게 되면 암호화의 의미가 없게 됩니다.

**두 개의 키를 사용하는 공개키 암호**
공통키 암호의 문제를 해결하려고 한 것. 공개키 암호에선느 서로 다른 두 개의 키 페어(쌍)을 사용합니다. 한쪽은 비밀키(private key)라 부르고 다른 한쪽은 공개키(public key)라고 부릅니다.
비밀키는 누구에게도 알려지면 안되는 키이며 공개키는 누구에게나 알려져도 괜찮은 키입니다.
공개키 암호를 사용한 암호화는 암호를 보내는 측이 상대의 공개키를 사용해 암호화를 합니다. 그리고 암호화된 정보를 받아들인 상대는 자신의 비밀키를 사용해 복호화를 실시합니다. 이 방식은 암호를 푸는 비밀키를 통신으로 보낼 필요가 없기 때문에 도청에 의해서 키를 빼앗길 걱정은 없습니다.
또, 암호문과 공개키라는 정보에서 평문을 구하는 것은 매우 어려운 수학적인 특징 때문에 간단하지 않다.

**HTTPS는 하이브리드 시스템**
HTTPS는 공통키 암호화 공개키 암호의 양쪽 성질을 가진 하이브리드 암호 시스템. 공개키 암호는 공통키 암호에 비해서 처리 속도가 늦다.
두 가지 장점을 살릴 수 있도록 각각의 방식을 조합해서 통신.
키를 교환하는 곳에서는 공개키 암호를 사용하고 그 후의 통신에서 메시지를 교환하는 곳에서는 공통키 암호를 사용합니다.

### 7.2.4 공개키가 정확한지 아닌지를 증명하는 증명서

공개키를 검증하기 위해서 인증기관(CA:Certificate Authority)과 그 기관이 발행하는 공개키 증명서가 이용된다.
인증 기관은 다음과 같이 이용됩니다. 먼저 서버의 운영자가 인증 기관에 공개 키를 제출합니다. 인증 기관은 제출된 공개키에 디지털 서명을하고 서명이 끝난 공개키를 만듭니다. 그리고 공개키 인증서에 서명이 끝난 공개키를 담습니다.
서버는 이 인증 기관에 의해서 작성된 공개키 인증서를 클라이언트에 보내고 공개키 암호로 통신을 합니다. 공개키 인증서는 디지털 증명서나 즐여서 증명서라고 부르는 경우도 있습니다. 증명서를 받는 클라이언트는 증명 기관의 공개키를 사용해서 서버의 공개키를 인증한 것이 진짜 인증 기관이라는 것과 서버의 공개키가 신뢰할 수 있다는 것을 알 수 있습니다.

### 7.2.5 안전한 통신을 하는 HTTPS의 구조

**SSL과 TLS**
HTTPS에서는 SSL(Secure Socket Layer)과 TLS(Transport Layer Security)라는 두 개의 프로토콜이 사용되고 있습니다.

SSL을 사용하면 처리가 늦어지게 된다.
SSL 통신이 지연되는 이유는 두 가지이다. 하나는 통신 속도가 떨어지는 것과, 다른 하나는 CPU나 메모리 등의 리소스를 다량으로 소비함으로써 처리가 느려짐.
네트워크의 부하는 HTTP를 사용하는 경우에 비해 2배에서 100배정도 느려질 수 있다. TCP 접속과 HTTP의 리퀘스트/리스폰스 이외에 SSL에 필요한 통신이 추가되기 때문에 전체적으로 처리해야 할 통신이 증가한다.
다른 하나는 SSL은 반드시 암호화 처리를 하고 있기 때문에 서버나 클라이언트에서는 암호화나 복호화를 위한 계산을 할 필요가 있다. 그렇기 때문에 서버나 클라이언트의 리소스를 소비하게 되어 HTTP에 부담이 커짐.
