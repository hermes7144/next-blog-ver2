# HTTP 정보는 HTTP 메세지에 있다

## 3.1 HTTP 메시지

HTTP에서 교환하는 정보는 HTTP 메시지라고 불리는데 리퀘스트 측 HTTP 메시지를 리퀘스트 메시지, 리스폰스 측 HTTP 메시지를 리스폰스 메시지라고 부릅니다.

## 3.2 리퀘스트 메시지와 리스폰스 메시지의 구조

1. 시작 줄에는 실행되어야 할 요청, 또는 요청 수행에 대한 성공 또는 실패가 기록된다.
2. 옵션으로 HTTP 헤더 세트가 들어간다. 여기에는 요청에 대한 설명, 혹은 메시지 본문에 대한 설명이 들어간다.
3. 요청에 대한 모든 메타 정보가 전송되었음을 알리는 빈 줄이 삽입됨.
4. 요청에 관련된 내용(HTML 폼 콘텐츠 등)이 옵션으로 들어가거나, 응답과 관련된 문서(document)가 들어갑니다. 본문의 존재 유무 및 크기는 첫 줄과 HTTP 헤더에 명시됩니다.

HTTP 메시지의 시작 줄과 HTTP 헤더를 묶어서 **요청 헤드(head)**라고 부르며, 이와 반대로 HTTP 메시지의 페이로드는 **본문(body)**이라고 합니다.

## 3.3 인코딩으로 전송 효율을 높이다

### 3.3.1 메시지 바디와 엔티티 바디의 차이

- 메시지(message)
  HTTP 통신의 기본 단위로 옥텟 시퀀스로 구성되고 통신을 통해서 전송됩니다.
- 엔티티(entity)
  리퀘스트랑 리스폰스의 페이로드(payload, 부가물)로 전송되는 정보로 엔티티 헤더 필드와 엔티티 바디로 구성됩니다.

HTTP 메시지 바디의 역할은 리퀘스트랑 리스폰스에 관한 엔티티 바디를 운반하는 일입니다. 기본적으로 메시지 바디와 엔티티 바디는 같지만 전송 코딩이 적용된 경우에는 엔티티 바디의 내용이 변화하기 때문에 메시지 바디와 달라집니다.

### 3.2.2 압축해서 보내는 콘텐츠 코딩

콘텐츠 코딩은 엔티티에 적용하는 인코딩을 가리키는데 엔티티 정보를 유지한채로 압축된다. 콘텐츠 엔티티는 수신한 클라이언트 측에서 디코딩합니다.

### 3.3.3 분해해서 보내는 청크 전송 코딩

엔티티 바디를 분할하는 기능을 청크 전송 코딩이라 함.
청크 전송 코딩은 엔티티 바디를 청크(덩어리)로 분해합니다. 다음 청크 사이즈를 16진수로 사용해서 단락을 표시하고 엔티티 바디 끝에는 "0(CR+LF)"를 기록해 둡니다.
청크 전송 코딩된 엔티티 바디는 수신한 클라이언트 측에서 원래의 엔티티 바디로 디코딩합니다. HTTP/1.1에는 전송 코딩이라는, 어떤 인코딩 방식에 따라서 전송하는 구조가 마련되어 있지만 전송 코딩에는 청크 전송 코딩만 정의되어 있습니다.

## 3.4 여러 데이터를 보내는 멀티파트

HTTP도 멀티파트에 대응하고 있어 하나의 메세지 바디 내부에 엔티티를 여러 개 포함시켜 보낼 수 있습니다. 주로 이미지나 텍스트 파일 등을 업로드할 때 사용합니다.
멀티파트 종류

- multipart/form-data
  Web 폼으로부터 파일 업로드에 사용됩니다.
- multipart/byteranges
  상태 코드 206(Partial Content) 리스폰스 메시지가 복수 범위의 내용을 포함하는 때에 사용됩니다.
  HTTP 메시지로 멀티파트를 사용할 때에는 Content-type 헤더 필드를 사용합니다.

## 3.5 일부분만 받는 레인지 리퀘스트

## 3.6 콘텐츠 네고시에이션

같은 콘텐츠(내용)이지만 여러 개의 페이지를 지닌 웹 페이지가 있습니다. 예를 들면, 내용은 같지만 영어판과 한국어판과 같이 표시되는 언어가 서로 다른 웹 페이지의 경우.
콘텐츠 네고시에이션이란 클라이언트와 서버가 제공하는 리소스의 내용에 대해서 교섭하는 것입니다. 클라이언트에 더욱 적합한 리소스를 제공하기 위한 구조.
콘텐츠 네고시에이션은 제공하는 리소스를 언어와 문자 세트, 인코딩 방식 등을 기준으로 판단.
판단 기준은 리퀘스트 메시지에 포함된 헤더 필드.

- Accept
- Accept-Charset
- Accept-Encoding
- Accept-Language
- Content-Language

콘텐츠 네고시에이션 종류

### 서버 구동형 네고시에이션(Server-driven Negotiation)

서버 측에서 콘텐츠 네고시에이션을 하는 방식. 서버 측에서 리퀘스트 헤더 필드의 정보를 참고해서 자동적으로 처리.

### 에이전트 구동형 네고시에이션(Agent-driven Negotiation)

클라이언트 측에서 콘텐츠 네고시에이션을 하는 방식. 브라우저에 표시된 선택지 중에서 유저가 수동으로 선택.

### 트랜스페런트 네고시에이션(Transparent Negotiation)

서버 구동형과 에이전트 구동형을 혼합한 것으로 서버와 클라이언트가 각각 콘텐츠 네고시에이션을 하는 방식입니다.
